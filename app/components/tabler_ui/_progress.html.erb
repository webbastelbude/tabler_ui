<%
  # Extract values with safe access
  percent = progress.respond_to?(:percent) ? progress.percent.to_f : 0
  color = progress.respond_to?(:color) ? progress.color : 'primary'
  height = progress.respond_to?(:height) ? progress.height : nil
  label = progress.respond_to?(:label) ? progress.label : nil
  show_percent = progress.respond_to?(:show_percent) ? progress.show_percent : false
  size = progress.respond_to?(:size) ? progress.size : nil # sm, md, lg

  # Clamp percent between 0 and 100
  percent = [[percent, 0].max, 100].min

  # Size classes
  size_class = size.present? ? "progress-#{size}" : ''

  # Auto-color based on percent if not specified
  if color == 'auto'
    color = if percent >= 90
              'danger'
            elsif percent >= 75
              'warning'
            else
              'success'
            end
  end

  # Height style
  height_style = height.present? ? "height: #{height};" : ''
%>

<% if label.present? %>
  <div class="d-flex mb-1">
    <div class=""><%= label %></div>
    <% if show_percent %>
      <div class="ms-auto text-secondary"><%= percent.round(1) %>%</div>
    <% end %>
  </div>
<% end %>
<div class="progress <%= size_class %>" <% if height_style.present? %>style="<%= height_style %>"<% end %>>
  <div class="progress-bar bg-<%= color %>" style="width: <%= percent %>%" role="progressbar" aria-valuenow="<%= percent %>" aria-valuemin="0" aria-valuemax="100">
    <% if show_percent && label.blank? %>
      <span class="visually-hidden"><%= percent.round(1) %>%</span>
    <% end %>
  </div>
</div>
