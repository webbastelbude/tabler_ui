<%
  # Extract values with safe access
  label = stat_card.respond_to?(:label) ? stat_card.label : nil
  value = stat_card.respond_to?(:value) ? stat_card.value : nil
  icon = stat_card.respond_to?(:icon) ? stat_card.icon : nil
  trend = stat_card.respond_to?(:trend) ? stat_card.trend : nil
  description = stat_card.respond_to?(:description) ? stat_card.description : nil
  color = stat_card.respond_to?(:color) ? stat_card.color : nil
  url = stat_card.respond_to?(:url) ? stat_card.url : nil

  # Trend color
  trend_color = trend.to_i > 0 ? 'green' : 'red' if trend.present?
  trend_prefix = trend.to_i > 0 ? '+' : '' if trend.present?
%>

<div class="card">
  <div class="card-body">
    <div class="d-flex align-items-center">
      <div class="subheader"><%= label %></div>
      <% if trend.present? %>
        <span class="ms-auto lh-1 text-<%= trend_color %> d-inline-flex align-items-center">
          <% if trend.to_i > 0 %>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="3 17 9 11 13 15 21 7" /><polyline points="14 7 21 7 21 14" /></svg>
          <% else %>
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-sm me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="3 7 9 13 13 9 21 17" /><polyline points="21 10 21 17 14 17" /></svg>
          <% end %>
          <%= trend_prefix %><%= trend %>%
        </span>
      <% end %>
    </div>
    <div class="d-flex align-items-center pt-2">
      <% if icon.present? %>
        <span class="icon-box bg-<%= color || 'primary' %>-lt me-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-<%= icon %> text-<%= color || 'primary' %>" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <use href="/assets/tabler-icons.svg#tabler-<%= icon %>" />
          </svg>
        </span>
      <% end %>
      <div>
        <div class="h1 mb-0"><%= value %></div>
        <% if description.present? %>
          <div class="text-secondary small"><%= description %></div>
        <% end %>
      </div>
      <% if url.present? %>
        <div class="ms-auto">
          <a href="<%= url %>" class="btn btn-sm btn-outline-primary">
            Details
          </a>
        </div>
      <% end %>
    </div>
  </div>
</div>
